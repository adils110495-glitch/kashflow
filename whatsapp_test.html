<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Share Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px;
            background: #25D366;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #128C7E;
        }
        .test-link {
            margin: 10px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            word-break: break-all;
        }
        .console-output {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>WhatsApp Share Functionality Test</h1>
    
    <div class="test-section">
        <h2>Test Links</h2>
        <p>Test different WhatsApp URL formats:</p>
        
        <div class="test-link">
            <strong>Test Link:</strong> https://example.com/register?ref=test123
        </div>
        
        <button class="test-button" onclick="testWhatsApp('https://wa.me/?text=')">
            <i class="fab fa-whatsapp"></i> Test wa.me
        </button>
        
        <button class="test-button" onclick="testWhatsApp('https://web.whatsapp.com/send?text=')">
            <i class="fab fa-whatsapp"></i> Test WhatsApp Web
        </button>
        
        <button class="test-button" onclick="testWhatsApp('whatsapp://send?text=')">
            <i class="fab fa-whatsapp"></i> Test WhatsApp App
        </button>
        
        <button class="test-button" onclick="testWhatsApp('https://api.whatsapp.com/send?text=')">
            <i class="fab fa-whatsapp"></i> Test API WhatsApp
        </button>
    </div>
    
    <div class="test-section">
        <h2>Console Output</h2>
        <div id="console-output" class="console-output"></div>
    </div>
    
    <div class="test-section">
        <h2>Device Information</h2>
        <div id="device-info"></div>
    </div>

    <script>
        // Capture console output
        const originalLog = console.log;
        const originalError = console.error;
        const consoleOutput = document.getElementById('console-output');
        
        function addToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f00' : '#0f0';
            consoleOutput.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };
        
        // Show device information
        const deviceInfo = document.getElementById('device-info');
        deviceInfo.innerHTML = `
            <p><strong>User Agent:</strong> ${navigator.userAgent}</p>
            <p><strong>Platform:</strong> ${navigator.platform}</p>
            <p><strong>Is Mobile:</strong> ${/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}</p>
            <p><strong>Is Android:</strong> ${navigator.userAgent.toLowerCase().includes('android')}</p>
        `;
        
        function testWhatsApp(baseUrl) {
            const testLink = 'https://example.com/register?ref=test123';
            const message = 'Join me on KashFlow! Use my referral link to register: ' + testLink;
            const whatsappUrl = baseUrl + encodeURIComponent(message);
            
            console.log('Testing WhatsApp URL:', whatsappUrl);
            console.log('Original message:', message);
            
            try {
                const newWindow = window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
                
                if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                    console.log('Popup blocked, trying alternative method');
                    
                    // Try alternative method
                    const tempLink = document.createElement('a');
                    tempLink.href = whatsappUrl;
                    tempLink.target = '_blank';
                    tempLink.rel = 'noopener noreferrer';
                    document.body.appendChild(tempLink);
                    tempLink.click();
                    document.body.removeChild(tempLink);
                    
                    console.log('Alternative method executed');
                } else {
                    console.log('WhatsApp opened successfully in new tab');
                }
            } catch (error) {
                console.error('WhatsApp test error:', error);
            }
        }
        
        // Test on page load
        console.log('WhatsApp Share Test Page Loaded');
        console.log('User Agent:', navigator.userAgent);
    </script>
</body>
</html>
